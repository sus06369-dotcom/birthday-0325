<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç”Ÿæ—¥é©šå–œ - ç¬¬äºŒé </title>

  <!-- å¯æ„›å­—å‹ï¼ˆé›²ç«¯è¼‰å…¥ï¼Œå°æ–¹ä¹Ÿèƒ½çœ‹åˆ°ï¼‰ -->
  <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet"/>

  <style>
    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      background: linear-gradient(to right, #fbc2eb, #d8b4fe); /* ç²‰ç´«æ¼¸å±¤ */
      font-family: 'ZCOOL KuaiLe', 'Noto Sans TC', sans-serif;
      color: #4b0082;
    }

    /* ä¸‰å±¤ï¼šèƒŒæ™¯ç¢èŠ± â†’ æ–‡å­— â†’ ç²’å­ */
    #bg, #fx {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    #stage {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      z-index: 1;
      padding: 2rem;
    }

    #text {
      font-size: min(12vw, 64px);
      line-height: 1.08;
      transform: scale(0.6);
      opacity: 0;
      transition: transform 420ms ease, opacity 420ms ease;
      will-change: transform, opacity;
      text-shadow: 0 2px 0 rgba(255,255,255,0.35);
      user-select: none;
    }
    #text.show { transform: scale(1.06); opacity: 1; }

    /* å°è¢å¹•å¾®èª¿è¡Œé«˜ */
    @media (max-width: 360px) { #text { line-height: 1.0; } }
  </style>
</head>
<body>
  <!-- èƒŒæ™¯ç¢èŠ±ï¼ˆæŒçºŒé£„ï¼‰ -->
  <canvas id="bg"></canvas>
  <!-- ç½®ä¸­æ–‡å­— -->
  <div id="stage"><div id="text"></div></div>
  <!-- æ–‡å­—ç²’å­çˆ†ç‚¸ -->
  <canvas id="fx"></canvas>

  <!-- èƒŒæ™¯éŸ³æ¨‚ï¼šæŠŠæª”åæ›æˆä½ ä¸Šå‚³çš„æª”æ¡ˆï¼ˆä¾‹å¦‚ happy.mp3ï¼‰ -->
  <audio id="bgm" autoplay loop>
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <script>
    /*********** æ–‡å­—é †åº ***********/
    const messages = [
      "5","4","3","2","1",
      "å˜¿ï½èŠèŒ‰å¦²çµ²",
      "ä»Šå¤©æ˜¯å±¬æ–¼",
      "ğŸ«µğŸ»ğŸ«µğŸ»ä½ ğŸ«µğŸ»ğŸ«µğŸ»",
      "ç‰¹åˆ¥æ—¥å­ï¼ï¼ï¼",
      "æº–å‚™å¥½äº†å—ï¼ŸğŸ§",
      "å°±ç®—é‚„æ²’ğŸ‘€",
      "ä¹Ÿçµ¦æˆ‘æº–å‚™å¥½ğŸ˜",
      "ä¸ç­‰ä½ çš„ğŸ¥³"
    ];

    /*********** å°å·¥å…· ***********/
    const delay = ms => new Promise(r => setTimeout(r, ms));
    async function ensureFonts() {
      if (document.fonts && document.fonts.ready) {
        try { await document.fonts.ready; } catch(e){}
      }
    }

    function fitCanvas(canvas) {
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const w = window.innerWidth, h = window.innerHeight;
      canvas.width = Math.floor(w * dpr);
      canvas.height = Math.floor(h * dpr);
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      const ctx = canvas.getContext('2d');
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      return ctx;
    }

    /*********** èƒŒæ™¯ç¢èŠ± ***********/
    const bg = document.getElementById('bg');
    const bgCtx = fitCanvas(bg);
    let flakes = [];
    function initFlakes(n = 130) {
      flakes = Array.from({length:n}, () => ({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight,
        r: Math.random()*5 + 3,
        vx: (Math.random()-0.5)*0.6,
        vy: Math.random()*1.2 + 0.7,
        rot: Math.random()*Math.PI*2,
        vr: (Math.random()-0.5)*0.08,
        color: hsl(${Math.random()*360}, 95%, 60%)
      }));
    }
    function drawFlakes() {
      bgCtx.clearRect(0,0,window.innerWidth, window.innerHeight);
      for (const f of flakes) {
        bgCtx.save();
        bgCtx.translate(f.x, f.y);
        bgCtx.rotate(f.rot);
        bgCtx.fillStyle = f.color;
        const s=f.r;
        bgCtx.beginPath();
        bgCtx.moveTo(0,-s); bgCtx.lineTo(s,0); bgCtx.lineTo(0,s); bgCtx.lineTo(-s,0);
        bgCtx.closePath(); bgCtx.fill();
        bgCtx.restore();

        f.x += f.vx; f.y += f.vy; f.rot += f.vr;
        if (f.y - f.r > window.innerHeight) { f.y = -10; f.x = Math.random()*window.innerWidth; }
        if (f.x < -20) f.x = window.innerWidth + 20;
        if (f.x > window.innerWidth + 20) f.x = -20;
      }
      requestAnimationFrame(drawFlakes);
    }

    /*********** ç²’å­çˆ†ç‚¸ï¼ˆå¾æ–‡å­—è¼ªå»“ç‚¸é–‹ï¼‰ ***********/
    const fx = document.getElementById('fx');
    const fxCtx = fitCanvas(fx);
    let particles = [];

    function explodeTextToParticles(text) {
      // å…ˆæŠŠæ–‡å­—ç•«åˆ°é›¢å± canvas
      const off = document.createElement('canvas');
      const offCtx = off.getContext('2d');
      const W = window.innerWidth, H = window.innerHeight;
      off.width = W; off.height = H;

      // è‡ªé©æ‡‰å­—é«”å¤§å°ï¼šçŸ­å­—å¤§ã€é•·å­—å°
      const minSide = Math.min(W, H);
      const base = Math.min(0.22 * minSide, 120);
      const len = Math.max(2, text.length);
      const fontSize = (len <= 2 ? base*1.25 : base * (8/Math.max(6,len)));
      offCtx.fillStyle = '#222';
      offCtx.textAlign = 'center';
      offCtx.textBaseline = 'middle';
      offCtx.font = `700 ${fontSize}px 'ZCOOL KuaiLe','Noto Sans TC',sans-serif`;
      offCtx.fillText(text, W/2, H/2);

      // æŠ½æ¨£åƒç´ ï¼ˆæ­¥è·å°=æ›´å¯†ï¼Œæ•¸å­—å¯èª¿ï¼‰
      const img = offCtx.getImageData(0,0,W,H).data;
      const step = Math.max(3, Math.floor(fontSize/14)); // 3 æ›´å¯†ã€5 æ›´çœæ•ˆèƒ½
      const cx = W/2, cy = H/2;

      for (let y = 0; y < H; y += step) {
        for (let x = 0; x < W; x += step) {
          const a = img[(y*W + x)*4 + 3];
          if (a > 80 && Math.random() < 0.95) {
            const ang = Math.atan2(y - cy, x - cx) + (Math.random()-0.5)*0.7;
            const spd = 2.2 + Math.random()*3.6; // é€Ÿåº¦æ›´æœ‰çˆ†ç‚¸æ„Ÿ
            particles.push({
              x, y,
              vx: Math.cos(ang)*spd,
              vy: Math.sin(ang)*spd,
              life: 70 + Math.random()*45,
              size: Math.random()*2 + 1.4,
              color: hsl(${Math.random()*360}, 95%, 60%)
            });
          }
        }
      }
    }

    function animateParticles() {
      fxCtx.clearRect(0,0, window.innerWidth, window.innerHeight);
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx; p.y += p.vy;
        p.vy += 0.06;     // é‡åŠ›
        p.vx *= 0.99;     // é˜»åŠ›
        p.vy *= 0.99;
        p.life--;

        fxCtx.globalAlpha = Math.max(0, p.life/100);
        fxCtx.fillStyle = p.color;
        fxCtx.beginPath();
        fxCtx.arc(p.x, p.y, p.size, 0, Math.PI*2);
        fxCtx.fill();
        fxCtx.globalAlpha = 1;

        if (p.life <= 0) particles.splice(i, 1);
      }
      requestAnimationFrame(animateParticles);
    }

    /*********** é€æ®µé¡¯ç¤ºçš„ä¸»æµç¨‹ï¼ˆç­‰å­—å‹â†’é¡¯ç¤ºâ†’çˆ†ç‚¸ï¼‰ ***********/
    const textEl = document.getElementById('text');
    async function runSequence() {
      await ensureFonts(); // å…ˆç­‰å­—å‹è¼‰å…¥ï¼Œé¿å…çˆ†éŒ¯ä½
      for (let i = 0; i < messages.length; i++) {
        const msg = messages[i];

        textEl.textContent = msg;
        textEl.classList.remove('show');
        await new Promise(r => requestAnimationFrame(r)); // è®“ç€è¦½å™¨å…ˆä½ˆå±€
        textEl.classList.add('show');

        explodeTextToParticles(msg);   // åŒæ­¥è§¸ç™¼ç²’å­çˆ†ç‚¸
        await delay(1200);             // ç¯€å¥ï¼ˆå¯æ”¹ 1000~1600ï¼‰
        textEl.classList.remove('show');
        await delay(160);
      }
      // å…¨éƒ¨è·‘å®Œ â†’ ç™½å…‰ä¸€ä¸‹ â†’ è·³ç¬¬ä¸‰é 
      flashAndGo();
    }

    function flashAndGo() {
      const flash = document.createElement('div');
      Object.assign(flash.style, {
        position:'fixed', inset:0, background:'white', opacity:0, zIndex:9999,
        transition:'opacity 220ms ease'
      });
      document.body.appendChild(flash);
      requestAnimationFrame(()=> flash.style.opacity = 1);
      setTimeout(()=> window.location.href = 'third.html', 260);
    }

    /*********** éŸ³æ¨‚å•Ÿå‹•ï¼ˆiOS å¯èƒ½éœ€è¦è§¸æ§ï¼‰ ***********/
    (function ensureBgm(){
      const a = document.getElementById('bgm');
      const tryPlay = () => a.play().catch(()=>{});
      document.addEventListener('click', tryPlay, { once:true });
      document.addEventListener('touchstart', tryPlay, { once:true });
      tryPlay();
    })();

    /*********** å•Ÿå‹•ã€å°ºå¯¸ ***********/
    function resizeAll() { fitCanvas(bg); fitCanvas(fx); }
    window.addEventListener('resize', ()=>{ resizeAll(); initFlakes(flakes.length); });

    // åˆå§‹
    initFlakes(140);
    drawFlakes();
    animateParticles();
    runSequence();
  </script>
</body>
</html>
