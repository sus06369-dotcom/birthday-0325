<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ç”Ÿæ—¥å°é©šå–œ Part 2</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@700&display=swap" rel="stylesheet">

<style>
  :root{
    --fg:#4b0082;
    --bgA:#d8b4fe;
    --bgB:#fbc2eb;
  }

  html,body{height:100%;margin:0;padding:0;}
  body{
    min-height:100vh;
    background: linear-gradient(to right, var(--bgA), var(--bgB));
    font-family: 'Noto Sans TC', sans-serif;
    overflow:hidden;
    color:var(--fg);
    position:relative;
  }

  .slide{
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
  }

  .message{
    text-align:center;
    max-width:90%;
    padding:0 12px;
    color:var(--fg);
    font-weight:700;
    white-space: nowrap;
    overflow:hidden;
  }

  /* ğŸ”¹ ä¸­æ–‡æ–‡å­—å‹•ç•«ï¼ˆç¸®æ”¾æ›´æ˜é¡¯ï¼Œä¸æœƒé¦¬ä¸Šæ¶ˆå¤±ï¼‰ */
  .message.text{
    font-size: clamp(28px, 7.5vw, 72px);
    animation: textZoomIn 2s forwards;
  }

  @keyframes textZoomIn{
    0%   { opacity:0; transform: scale(0.5); }
    25%  { opacity:1; transform: scale(1.25); }
    55%  { opacity:1; transform: scale(1); }
    100% { opacity:1; transform: scale(1); }
  }

  /* ğŸ”¹ å€’æ•¸æ•¸å­—ç¶­æŒåŸæœ¬ç¸®æ”¾ï¼‹æ·¡å‡º */
  .message.number{
    font-size: clamp(64px, 28vw, 220px);
    animation: numberZoomFade 2s forwards;
  }

  @keyframes numberZoomFade{
    0%   { opacity:0; transform: scale(0.5); }
    25%  { opacity:1; transform: scale(1.25); }
    55%  { opacity:1; transform: scale(1); }
    90%  { opacity:1; transform: scale(1); }
    100% { opacity:0; transform: scale(1); }
  }

  .confetti{
    position: fixed;
    top: -18px;
    width:10px; height:10px;
    border-radius:3px;
    opacity:0.95;
    z-index: 5;
    pointer-events:none;
    will-change: transform;
    animation: confettiFall linear forwards;
  }

  @keyframes confettiFall{
    to { transform: translateY(110vh) translateX(var(--drift,0px)) rotate(720deg); }
  }

  @media (max-width:420px){
    .message.text{ font-size: clamp(20px, 8.5vw, 40px); }
    .message.number{ font-size: clamp(48px, 30vw, 160px); }
  }
</style>
</head>
<body>

<audio id="bgm" autoplay loop>
  <source src="blessing.mp3" type="audio/mpeg">
</audio>

<!-- ğŸ‚ è›‹ç³•ç•«å¸ƒ -->
<canvas id="cakeCanvas" width="500" height="400" style="display:none;position:absolute;left:50%;top:55%;transform:translate(-50%,-50%);"></canvas>

<script>
const bgm = document.getElementById('bgm');
const wantA = localStorage.getItem('bgmAllowed') === 'true';
const wantB = localStorage.getItem('bgmPlaying') === 'true';
if (wantA || wantB) {
  bgm.play().catch(()=>{ console.log('bgm.play() è¢«é˜»æ“‹'); });
}

const messages = [
  "å˜¿ï½èŠèŒ‰å¦²çµ²",
  "ä»Šå¤©æ˜¯å±¬æ–¼",
  "ğŸ«µğŸ»ğŸ«µğŸ»ä½ ğŸ«µğŸ»ğŸ«µğŸ»",
  "ç‰¹åˆ¥æ—¥å­ï¼ï¼ï¼",
  "æº–å‚™å¥½äº†å—ï¼ŸğŸ§",
  "å°±ç®—é‚„æ²’ğŸ‘€",
  "ä¹Ÿçµ¦æˆ‘æº–å‚™å¥½ğŸ˜",
  "ä¸ç­‰ä½ çš„ğŸ¥³",
  "5","4","3","2","1"
];

let idx = 0;
const DURATION_NORMAL = 2000;
const DURATION_NUMBER = 2000;

function showNext(){
  if (idx >= messages.length){
    showCake();
    return;
  }
  const txt = messages[idx];
  const isNumber = !isNaN(txt);

  const slide = document.createElement('div');
  slide.className = 'slide';

  const msg = document.createElement('div');
  msg.className = 'message ' + (isNumber ? 'number' : 'text');
  msg.textContent = txt;

  slide.appendChild(msg);
  document.body.appendChild(slide);

  const dur = isNumber ? DURATION_NUMBER : DURATION_NORMAL;
  setTimeout(()=> {
    slide.remove();
    idx++;
    showNext();
  }, dur);
}
showNext();

// ğŸ‰ å½©å±‘
function createConfetti(){
  const c = document.createElement('div');
  c.className = 'confetti';
  const colors = ["#ffd500","#ff69b4","#00bfff","#7cfc00","#ff4500","#ffffff"];
  c.style.background = colors[Math.floor(Math.random()*colors.length)];
  c.style.left = Math.random() * window.innerWidth + 'px';
  const size = Math.random() * 14 + 6;
  c.style.width = size + 'px';
  c.style.height = size + 'px';
  const drift = (Math.random()*260 - 130) + 'px';
  c.style.setProperty('--drift', drift);
  const duration = Math.random()*3 + 2;
  c.style.animationDuration = duration + 's';

  document.body.appendChild(c);
  setTimeout(()=> c.remove(), duration*1000 + 200);
}
setInterval(createConfetti, 120);

// ğŸ‚ æ”¹è‰¯ç‰ˆ showCake()ï¼šæ¨¡æ“¬ Turtle æ…¢æ…¢ç•«å‡ºè›‹ç³•
function showCake(){
  const canvas = document.getElementById("cakeCanvas");
  const ctx = canvas.getContext("2d");
  canvas.style.display = "block";

  ctx.lineWidth = 3;
  ctx.strokeStyle = "#333";
  ctx.fillStyle = "#fff";

  function roundRect(x, y, w, h, r, color){
    ctx.beginPath();
    ctx.moveTo(x+r, y);
    ctx.arcTo(x+w, y,   x+w, y+h, r);
    ctx.arcTo(x+w, y+h, x,   y+h, r);
    ctx.arcTo(x,   y+h, x,   y,   r);
    ctx.arcTo(x,   y,   x+w, y,   r);
    ctx.closePath();
    ctx.fillStyle = color;
    ctx.fill();
    ctx.stroke();
  }

  let steps = [];

  // è›‹ç³•åº•å±¤
  steps.push(()=> roundRect(100, 250, 300, 80, 40, "#fff0f3"));
  steps.push(()=> roundRect(120, 220, 260, 60, 30, "#f2d7dd"));

  // è›‹ç³•ä¸Šå±¤
  steps.push(()=> roundRect(150, 150, 200, 60, 30, "#ffe4e1"));
  steps.push(()=> roundRect(170, 120, 160, 50, 25, "#ffc3be"));

  // è Ÿç‡­
  const candleX = [180, 220, 250, 280, 320];
  candleX.forEach(x=>{
    steps.push(()=>{
      ctx.fillStyle = "#87cefa";
      ctx.fillRect(x, 90, 10, 40);
      ctx.fillStyle = "white";
      for(let i=0;i<5;i++){
        ctx.fillRect(x, 90+i*8, 10, 2);
      }
      ctx.strokeRect(x, 90, 10, 40);
    });
  });

  // ä¸€æ­¥ä¸€æ­¥ç•«å‡ºä¾†
  let i = 0;
  function drawStep(){
    if(i < steps.length){
      steps[i]();
      i++;
      setTimeout(drawStep, 500);
    } else {
      // ç«ç„°å‹•ç•«
      function drawFlames(){
        ctx.clearRect(0,0,canvas.width,90);
        candleX.forEach(x=>{
          ctx.beginPath();
          ctx.ellipse(x+5, 80, 6, 10, 0, 0, Math.PI*2);
          ctx.fillStyle = "rgba(255,165,0,"+(0.6+Math.random()*0.4)+")";
          ctx.fill();
        });
      }
      setInterval(drawFlames, 200);
    }
  }
  drawStep();
}
</script>
</body>
</html>
