<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ç”Ÿæ—¥å°é©šå–œ Part 2</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@700&display=swap" rel="stylesheet">

<style>
  :root{
    --fg:#4b0082;
    --bgA:#d8b4fe;
    --bgB:#fbc2eb;
  }

  html,body{height:100%;margin:0;padding:0;}
  body{
    min-height:100vh;
    background: linear-gradient(to right, var(--bgA), var(--bgB)); /* ç´«ç²‰æ¼¸å±¤ */
    font-family: 'Noto Sans TC', sans-serif;
    overflow:hidden;
    color:var(--fg);
    position:relative;
  }

  /* æ¯æ®µæ–‡å­—çš„å…¨è¢å¹• slide */
  .slide{
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
    z-index:20; /* æ–‡å­—åœ¨æœ€ä¸Šå±¤ */
  }
  .message{
    text-align:center;
    width:100%;
    padding:0 12px;
    color:var(--fg);
    font-weight:700;
    white-space: nowrap;
    overflow:hidden;
  }

  /* ä¸­æ–‡æ–‡å­—ï¼ˆåªç¸®æ”¾ï¼‰ */
  .message.text{
    font-size: clamp(28px, 7.5vw, 84px);
    animation: textZoomIn 1.8s forwards;
    color:#4b0082;
    text-shadow: 0 2px 0 rgba(255,255,255,0.6);
  }
  @keyframes textZoomIn{
    0%   { opacity:0; transform: scale(0.5); }
    25%  { opacity:1; transform: scale(1.25); }
    55%  { opacity:1; transform: scale(1); }
    100% { opacity:1; transform: scale(1); }
  }

  /* å€’æ•¸æ•¸å­—ï¼ˆæ”¾å¤§ç„¶å¾Œæ·¡å‡ºï¼‰ */
  .message.number{
    font-size: clamp(64px, 28vw, 240px);
    animation: numberZoomFade 2s forwards;
    color:#4b0082;
  }
  @keyframes numberZoomFade{
    0%   { opacity:0; transform: scale(0.5); }
    25%  { opacity:1; transform: scale(1.25); }
    55%  { opacity:1; transform: scale(1); }
    90%  { opacity:1; transform: scale(1); }
    100% { opacity:0; transform: scale(1); }
  }

  /* å½©å±‘ï¼ˆç”¨ divï¼‰*/
  .confetti{
    position: fixed;
    top: -18px;
    width:10px; height:10px;
    border-radius:3px;
    opacity:0.95;
    z-index:5; /* åœ¨èƒŒæ™¯ä¸Šæ–¹ä½†ä½æ–¼æ–‡å­— */
    pointer-events:none;
    will-change: transform;
    animation: confettiFall linear forwards;
  }
  @keyframes confettiFall{
    to { transform: translateY(110vh) translateX(var(--drift,0px)) rotate(720deg); }
  }

  /* è›‹ç³•å€ï¼ˆç½®ä¸­ï¼‰ */
  #cakeWrapper{
    position: fixed;
    left:50%;
    top:48%;
    transform: translate(-50%,-50%);
    z-index:10;
    display:none; /* é è¨­éš±è—ï¼Œç­‰æ–‡å­—æ’­å®Œå†é¡¯ç¤º */
    pointer-events:auto;
    text-align:center;
  }
  video#cakeVideo, img#cakeGif {
    width: min(420px, 78vw);
    max-width:78vw;
    display:block;
    margin:0 auto;
    border-radius:10px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    opacity:0;
    transition: opacity 350ms linear;
  }

  /* å‡ºç¾ç¥è³€æ–‡å­— & æŒ‰éˆ• */
  #greeting{
    position: fixed;
    z-index: 15;
    left:50%;
    top:66%;
    transform: translateX(-50%) scale(0.7);
    font-size: clamp(28px,6.5vw,56px);
    color: #4b0082;
    opacity:0;
    text-align:center;
    font-weight:700;
    text-shadow:0 2px 0 rgba(255,255,255,0.6);
  }

  #buttonRow{
    position: fixed;
    z-index:15;
    left:50%;
    top:76%;
    transform: translateX(-50%);
    opacity:0;
    display:flex;
    gap:18px;
    justify-content:center;
    align-items:center;
  }
  .btn{
    padding:12px 22px;
    font-size:18px;
    border-radius:12px;
    border:none;
    cursor:pointer;
    color:#fff;
    transition: transform .25s ease, opacity .25s ease;
  }
  #likeBtn{ background:#ffb47a; }   /* æº«å’Œæ©˜ */
  #dislikeBtn{ background:#7ec7ff; }/* æº«å’Œè— */

  /* å°è¢å¹•å¾®èª¿ */
  @media (max-width:420px){
    .message.text{ font-size: clamp(20px, 8.5vw, 42px); }
    .message.number{ font-size: clamp(48px, 30vw, 160px); }
  }

  /* modal (ä¿ç•™ä¹‹å¾Œå‘¼å«) */
  .modal{
    display:none;
    position:fixed;
    inset:0;
    background: rgba(0,0,0,0.45);
    z-index:40;
    justify-content:center;
    align-items:center;
  }
  .modal .panel{
    background:#fff;
    padding:18px 22px;
    border-radius:12px;
    text-align:center;
    color:var(--fg);
    max-width:86%;
  }

</style>
</head>
<body>

<!-- èƒŒæ™¯éŸ³æ¨‚ -->
<audio id="bgm" loop>
  <source src="blessing.mp3" type="audio/mpeg">
</audio>

<!-- å½©å±‘æœƒå‹•æ…‹ç”¢ç”Ÿçš„å®¹å™¨ï¼ˆç›´æ¥ append child åˆ° bodyï¼‰ -->

<!-- æ–‡å­— slide ç”±ä¸‹é¢çš„ JS ç”¢ç”Ÿä¸¦æ’å…¥ body -->
<!-- è›‹ç³•å€ -->
<div id="cakeWrapper">
  <video id="cakeVideo" playsinline preload="auto">
    <source src="Cake1.webm" type="video/webm">
    <!-- å¤‡ç”¨ -->
    <source src="Cake1.mp4" type="video/mp4">
  </video>
  <img id="cakeGif" src="Cake2.gif" alt="cake gif" />
</div>

<!-- ç¥è³€èˆ‡æŒ‰éˆ• -->
<div id="greeting">ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†</div>
<div id="buttonRow">
  <button id="likeBtn" class="btn">æˆ‘å¾ˆå–œæ­¡</button>
  <button id="dislikeBtn" class="btn">æˆ‘ä¸å–œæ­¡</button>
</div>

<!-- modal placeholderï¼ˆé»æ“Šä¸å–œæ­¡è¶…éæ¬¡æ•¸æœƒå‘¼å«ï¼‰ -->
<div id="modalBox" class="modal"><div class="panel" id="modalPanel"><p id="modalText"></p><button onclick="closeModal()">é—œé–‰</button></div></div>

<script>
/* ========= èƒŒæ™¯éŸ³æ¨‚ï¼ˆå°Šé‡ç¬¬ä¸€é äº’å‹•ï¼‰ ========= */
const bgm = document.getElementById('bgm');
const allowed = localStorage.getItem('bgmAllowed') === 'true';
if (allowed) {
  bgm.play().catch(()=>{ console.log('bgm.play() è¢«é˜»æ“‹'); });
}

/* ========= è¦é¡¯ç¤ºçš„æ–‡å­—é™£åˆ—ï¼ˆå®Œæ•´ï¼‰ ========= */
const messages = [
  "å˜¿ï½èŠèŒ‰å¦²çµ²",
  "ä»Šå¤©æ˜¯å±¬æ–¼",
  "ğŸ«µğŸ»ğŸ«µğŸ»ä½ ğŸ«µğŸ»ğŸ«µğŸ»",
  "ç‰¹åˆ¥æ—¥å­ï¼ï¼ï¼",
  "æº–å‚™å¥½äº†å—ï¼ŸğŸ§",
  "å°±ç®—é‚„æ²’ğŸ‘€",
  "ä¹Ÿçµ¦æˆ‘æº–å‚™å¥½ğŸ˜",
  "ä¸ç­‰ä½ çš„ğŸ¥³",
  "5","4","3","2","1"
];

let idx = 0;
const DURATION_NORMAL = 1800; // ä¸­æ–‡æ®µé¡¯ç¤ºæ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
const DURATION_NUMBER = 2000; // æ•¸å­—å€’æ•¸æ™‚é–“

/* é¡¯ç¤ºæ¯ä¸€æ®µæ–‡å­—ï¼ˆè¦†è“‹æ•´å€‹ç•«é¢ï¼‰ */
function showNext(){
  if (idx >= messages.length) return;
  const txt = messages[idx];
  const isNumber = !isNaN(txt);

  const slide = document.createElement('div');
  slide.className = 'slide';

  const msg = document.createElement('div');
  msg.className = 'message ' + (isNumber ? 'number' : 'text');
  msg.textContent = txt;

  slide.appendChild(msg);
  document.body.appendChild(slide);

  const dur = isNumber ? DURATION_NUMBER : DURATION_NORMAL;
  setTimeout(()=> {
    slide.remove();
    idx++;
    if (idx < messages.length) {
      showNext();
    } else {
      // å€’æ•¸çµæŸ â†’ é¡¯ç¤ºè›‹ç³•å€
      showCake();
    }
  }, dur);
}

/* å•Ÿå‹•æ–‡å­—åºåˆ— */
showNext();

/* ========= å½©å±‘ï¼ˆç”¨ divï¼Œé¿å…è¦†è“‹èƒŒæ™¯ï¼‰ ========= */
function createConfetti(){
  const c = document.createElement('div');
  c.className = 'confetti';
  const colors = ["#ffd500","#ff69b4","#00bfff","#7cfc00","#ff4500","#ffffff"];
  c.style.background = colors[Math.floor(Math.random()*colors.length)];
  c.style.left = Math.random() * window.innerWidth + 'px';
  const size = Math.random() * 14 + 6;
  c.style.width = size + 'px';
  c.style.height = size + 'px';
  const drift = (Math.random()*260 - 130) + 'px';
  c.style.setProperty('--drift', drift);
  const duration = Math.random()*3 + 2;
  c.style.animationDuration = duration + 's';
  document.body.appendChild(c);
  setTimeout(()=> c.remove(), duration*1000 + 300);
}
/* æ¯ 110ms ç”Ÿæˆä¸€ç‰‡ï¼Œæ‰‹æ©Ÿä¸Šä¸è¦å¤ªé »ç¹ */
const confettiInterval = setInterval(createConfetti, 110);

/* ========= è›‹ç³• (video -> gif) ä¸¦ç„¡ç¸«åˆ‡æ› ========= */
const cakeWrapper = document.getElementById('cakeWrapper');
const cakeVideo = document.getElementById('cakeVideo');
const cakeGif = document.getElementById('cakeGif');
const greeting = document.getElementById('greeting');
const buttonRow = document.getElementById('buttonRow');

function showCake(){
  // é¡¯ç¤ºè›‹ç³•å®¹å™¨ï¼ˆå½±ç‰‡ï¼‰
  cakeWrapper.style.display = 'block';

  // å…ˆæŠŠ gif éš±è—ä½†å…ˆè¼‰å…¥ï¼ˆé¿å…å¾ŒçºŒé–ƒç™½ï¼‰
  cakeGif.style.display = 'block';
  cakeGif.style.opacity = 0;
  cakeGif.style.visibility = 'hidden';

  // å½±ç‰‡ç¢ºä¿ä¸é‡è¤‡ï¼ˆä¸è¦ loopï¼‰
  cakeVideo.loop = false;
  cakeVideo.style.opacity = 0;
  cakeVideo.style.display = 'block';

  // ç­‰å½±ç‰‡ metadata ready å†æ’­æ”¾ï¼ˆç¢ºä¿æ‰‹æ©Ÿä¸Šå¯æ’­æ”¾ï¼‰
  cakeVideo.play().catch(()=>{ /* è‹¥è¢«é˜»æ“‹ä¸å½±éŸ¿ */ });

  // fade-in video
  requestAnimationFrame(()=> {
    cakeVideo.style.opacity = 1;
  });

  // ç•¶å½±ç‰‡çµæŸæ™‚ç”¨ cross-fade åˆ‡æ›åˆ° gifï¼ˆé¿å…ç™½é–ƒï¼‰
  cakeVideo.addEventListener('ended', () => {
    // å…ˆç¢ºä¿ GIF å¯è¦‹ä½†é€æ˜
    cakeGif.style.visibility = 'visible';
    cakeGif.style.opacity = 0;
    // crossfade
    requestAnimationFrame(()=>{
      cakeVideo.style.transition = 'opacity 400ms linear';
      cakeGif.style.transition = 'opacity 400ms linear';
      cakeVideo.style.opacity = 0;
      cakeGif.style.opacity = 1;
    });
    // åœ¨ transition å®Œæˆå¾Œéš±è— video
    setTimeout(()=> {
      cakeVideo.style.display = 'none';
      cakeGif.style.opacity = 1;
      cakeGif.style.visibility = 'visible';
    }, 450);
  });

  // === å½±ç‰‡é–‹å§‹å¾Œ 15 ç§’é¡¯ç¤ºæ–‡å­— & æŒ‰éˆ•ï¼ˆä½ æŒ‡å®š cake1 å‡ºç¾å°±é–‹å§‹ç®—ï¼‰===
  cakeVideo.addEventListener('play', ()=>{
    setTimeout(()=> {
      // greeting ç¸®æ”¾å‡ºç¾
      greeting.style.opacity = 1;
      greeting.style.transform = 'translateX(-50%) scale(1)';
      // æ–‡å­—å…ˆç¸®æ”¾ï¼ŒæŒ‰éˆ•ç¨å¾Œæ·¡å…¥ï¼ˆå·¦å³åˆ†åˆ¥ä¾†æºï¼‰
      setTimeout(()=> {
        // æŒ‰éˆ•æ·¡å…¥ï¼šä½¿ç”¨å°å»¶é²æ­é… CSS transform
        buttonRow.style.opacity = 1;
        // è‹¥ä½ æƒ³è¦å·¦å³åˆ†åˆ¥å¾å…©é‚Šæ·¡å…¥ï¼Œå¯ä»¥ç”¨ transform translateX æ­é… transitionï¼ˆæ­¤è™•ç”¨ç°¡å–® fadeï¼‰
      }, 900);
    }, 15000); // 15 ç§’
  });
}

/* ========= æŒ‰éˆ•äº’å‹•ï¼ˆç°¡ç‰ˆï¼‰ ========= */
const likeBtn = document.getElementById('likeBtn');
const dislikeBtn = document.getElementById('dislikeBtn');
let dislikeCount = 0;

likeBtn.addEventListener('click', () => {
  // ä½ èªªæŒ‰ã€Œæˆ‘å¾ˆå–œæ­¡ã€è¦é€²ä¸‹ä¸€æ­¥ï¼Œé€™é‚Šå…ˆæ¸…é™¤ overlayï¼ˆç¯„ä¾‹ï¼‰
  // ä¹‹å¾Œä½ è¦æˆ‘é¡¯ç¤ºä¸‹ä¸€å€‹ç•«é¢å°±æŠŠé‚è¼¯å¯«åœ¨é€™è£¡
  // ç›®å‰ç¤ºç¯„ï¼šåœæ­¢å½©å±‘ä¸¦æ·¡å‡ºæ‰€æœ‰å…ƒä»¶ï¼ˆä½ å¯è‡ªè¡Œæ”¹ï¼‰
  clearInterval(confettiInterval);
  document.querySelectorAll('.confetti').forEach(e=>e.remove());
  cakeWrapper.style.transition = 'opacity 400ms';
  cakeWrapper.style.opacity = 0;
  greeting.style.opacity = 0;
  buttonRow.style.opacity = 0;
  // é€™è£¡ä¿ç•™æ“´å……å€å¡Š
});

dislikeBtn.addEventListener('click', () => {
  dislikeCount++;
  // å–œæ­¡æŒ‰éˆ•é€æ¼¸æ”¾å¤§
  likeBtn.style.transform = `scale(${1 + dislikeCount*0.18})`;
  // ä¸å–œæ­¡æŒ‰éˆ•äº‚è·‘ï¼ˆä¸è¶…å‡ºè¦–çª—ï¼‰
  dislikeBtn.style.position = 'absolute';
  const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
  const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
  // è¨ˆç®—ä¸æœƒè¶…å‡ºé‚Šç•Œçš„éš¨æ©Ÿä½ç½® (ç•™ 10% margin)
  const leftPct = 10 + Math.random()*80;
  const topPct = 20 + Math.random()*60;
  dislikeBtn.style.left = leftPct + '%';
  dislikeBtn.style.top = topPct + '%';
  dislikeBtn.style.transform = `translate(-50%,-50%) scale(${Math.max(0.6,1 - dislikeCount*0.08)})`;

  if (d
