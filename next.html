<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ç”Ÿæ—¥å°é©šå–œ Part 2</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@700&display=swap" rel="stylesheet">

  <style>
    :root{
      --fg:#4b0082;
      --bgA:#d8b4fe;
      --bgB:#fbc2eb;
    }
    html,body{height:100%;margin:0;padding:0;}
    body{
      min-height:100vh;
      background: linear-gradient(to right, var(--bgA), var(--bgB));
      font-family: 'Noto Sans TC', sans-serif;
      overflow:hidden;
      color:var(--fg);
      position:relative;
      text-align:center;
    }

    .slide{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; }

    .message{
      text-align:center;
      max-width:90%;
      padding:0 12px;
      color:var(--fg);
      font-weight:700;
      white-space: nowrap;
      overflow:hidden;
      font-size: clamp(28px, 7.5vw, 72px);
      opacity:0;
      transform: scale(.6);
      transition: transform .55s, opacity .45s;
    }

    .message.number{
      font-size: clamp(64px, 28vw, 220px);
      /* ç”¨åŒæ¨£çš„å…¥å ´å‹•ä½œï¼Œä½†èƒ½æ›´å¼·çƒˆ */
      animation: numberZoomFade 2s forwards;
    }
    @keyframes numberZoomFade{
      0%   { opacity:0; transform: scale(0.5); }
      25%  { opacity:1; transform: scale(1.25); }
      55%  { opacity:1; transform: scale(1); }
      90%  { opacity:1; transform: scale(1); }
      100% { opacity:0; transform: scale(1); }
    }

    /* cake å€ */ 
    #cakeWrapper {
      display: none;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      top: 8vh; /* é ä¸Šä½†ç½®ä¸­æ°´å¹³ */
      z-index: 2;
      text-align:center;
    }
    #cakeVideo, #cakeGif {
      max-width: 60%;
      height: auto;
      display: block;
      margin: 0 auto;
    }
    #cakeGif { display:none; }

    /* ä¸‹é¢çš„ç¥ç¦ & æŒ‰éˆ•ï¼ˆé è¨­éš±è—ï¼‰ */
    #afterCake {
      display: none;
      position: absolute;
      top: 62%;
      left: 50%;
      transform: translateX(-50%);
      text-align:center;
      z-index: 3;
    }
    #afterCake .celebrate {
      font-size: clamp(28px, 6vw, 56px);
      font-weight:700;
      color:var(--fg);
      opacity:0;
      transform: scale(0.6);
      transition: transform .6s, opacity .5s;
      white-space: nowrap;
    }
    #buttons {
      margin-top: 18px;
      display:flex;
      gap:20px;
      justify-content:center;
      opacity:0;
      transition: opacity .6s;
    }
    button {
      padding: 12px 24px;
      border-radius: 12px;
      border: none;
      font-weight:700;
      cursor: pointer;
      font-size: 1.05rem;
    }
    #likeBtn { background: #f4a261; color: white; } /* æº«å’Œæ©˜ */
    #dislikeBtn { background: #6ca0dc; color: white; } /* æº«å’Œè— */

    /* modal (å’Œç¬¬ä¸€é é¢¨æ ¼ä¸€è‡´) */
    .modal { display:none; position:fixed; inset:0; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; }
    .modal .modal-content {
      background:white; padding:20px 28px; border-radius:10px; color:var(--fg); font-weight:700; text-align:center;
      box-shadow: 0 6px 18px rgba(0,0,0,0.2);
    }

    /* confetti (ç°¡å–®) */
    .confetti { position: absolute; width: 10px; height:10px; border-radius: 3px; top: -12px; opacity:0.95; }
    @keyframes fall { to { transform: translateY(110vh) rotate(720deg); opacity:0; } }
  </style>
</head>
<body>

  <!-- æ–‡å­—åºåˆ—å®¹å™¨ -->
  <div id="textRoot"></div>

  <!-- è›‹ç³•å€ -->
  <div id="cakeWrapper">
    <video id="cakeVideo" src="Cake1.webm" playsinline autoplay muted></video>
    <img id="cakeGif" src="Cake2.gif" alt="cake gif">
  </div>

  <!-- é¡¯ç¤ºç¥ç¦èˆ‡æŒ‰éˆ• -->
  <div id="afterCake">
    <div class="celebrate" id="celebrateText">ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã† ğŸ‚</div>
    <div id="buttons">
      <button id="likeBtn">æˆ‘å¾ˆå–œæ­¡</button>
      <button id="dislikeBtn">æˆ‘ä¸å–œæ­¡</button>
    </div>
  </div>

  <!-- èˆ‡ç¬¬ä¸€é ç›¸åŒé¢¨æ ¼çš„æç¤ºæ¡†ï¼ˆåªç”¨æ–¼ã€Œå¤ªå¤šä¸å–œæ­¡ã€é‚£æƒ…æ³ï¼‰ -->
  <div id="errorModal" class="modal">
    <div class="modal-content" id="errorContent">
      <p id="errorLine1">æ¬¸ï½éƒ½å·²ç¶“æç¤ºäº†</p>
      <p id="errorLine2">ä½ é‚„è¼¸å…¥éŒ¯èª¤å‚·å¿ƒäº†éƒ½ï½ï½</p>
      <button onclick="closeError()">å¥½å•¦æˆ‘é‡è©¦</button>
    </div>
  </div>

  <!-- èƒŒæ™¯éŸ³æ¨‚ï¼ˆä¸åœ¨æ­¤é äº’å‹•æ™‚å…ˆä»¥ localStorage åˆ¤æ–·ï¼Œindex.html æœ‰è¨­ï¼‰ -->
  <audio id="bgm" src="blessing.mp3" loop></audio>

<script>
/* === é é¢å•Ÿå‹•ï¼Œæ’­æ”¾éŸ³æ¨‚ï¼ˆè‹¥ index.html å·²ç¶“å…è¨±ï¼‰ & å•Ÿå‹•æ–‡å­—åºåˆ—èˆ‡å½©å±‘ === */
window.addEventListener('load', ()=> {
  const bgm = document.getElementById('bgm');
  if (localStorage.getItem('bgmAllowed') === 'true') {
    bgm.play().catch(()=> console.log('bgm autoplay blocked'));
  }
  startSequence();
  startConfetti();
});

/* æ–‡å­—åºåˆ—ï¼ˆæ¯æ®µå æ»¿ç•«é¢ï¼Œæœ€å¾Œé¡¯ç¤ºè›‹ç³•ï¼‰ */
const messages = [
  "å˜¿ï½èŠèŒ‰å¦²çµ²",
  "ä»Šå¤©æ˜¯å±¬æ–¼",
  "ğŸ«µğŸ»ğŸ«µğŸ»ä½ ğŸ«µğŸ»ğŸ«µğŸ»",
  "ç‰¹åˆ¥æ—¥å­ï¼ï¼ï¼",
  "æº–å‚™å¥½äº†å—ï¼ŸğŸ§",
  "å°±ç®—é‚„æ²’ğŸ‘€",
  "ä¹Ÿçµ¦æˆ‘æº–å‚™å¥½ğŸ˜",
  "ä¸ç­‰ä½ çš„ğŸ¥³",
  "3", "2", "1"
];

function startSequence(){
  const root = document.getElementById('textRoot');
  let i = 0;
  function showNext(){
    if (i < messages.length) {
      root.innerHTML = '';
      const slide = document.createElement('div');
      slide.className = 'slide';
      const msg = document.createElement('div');
      // æ•¸å­—ç”¨ bigger class (æ¨£å¼åœ¨ä¸Šé¢ä½¿ç”¨ .message.number)
      msg.className = (messages[i]==='3' || messages[i]==='2' || messages[i]==='1') ? 'message number' : 'message';
      msg.textContent = messages[i];
      slide.appendChild(msg);
      root.appendChild(slide);
      i++;
      setTimeout(showNext, 1500); // æ¯ 1.5 ç§’æ›ä¸€æ®µ
    } else {
      // çµæŸæ–‡å­—åºåˆ— â†’ é¡¯ç¤ºè›‹ç³•
      root.innerHTML = '';
      showCake();
    }
  }
  showNext();
}

/* è›‹ç³•ï¼šæ’­æ”¾ cakeVideoï¼ˆä¸€æ¬¡ï¼‰ï¼Œæ’­æ”¾å®Œåˆ‡æ›æˆ cakeGifï¼Œç„¶å¾Œé¡¯ç¤ºç¥ç¦æ–‡å­—èˆ‡æŒ‰éˆ• */
function showCake(){
  const cakeWrapper = document.getElementById('cakeWrapper');
  const video = document.getElementById('cakeVideo');
  const gif = document.getElementById('cakeGif');
  const after = document.getElementById('afterCake');

  // é¡¯ç¤ºå½±ç‰‡ï¼ˆå½±ç‰‡æœªè¨­å®š loopï¼‰
  cakeWrapper.style.display = 'block';

  // å…ˆå˜—è©¦æ’­æ”¾ï¼ˆvideo element å¯èƒ½éœ€è¦ muted æ‰èƒ½ autoplayï¼Œè¦–ä½ çš„æª”æ¡ˆï¼‰
  video.play().catch(()=> console.log('video play blocked'));

  // ç•¶å½±ç‰‡çµæŸï¼Œåˆ‡æ›åˆ° GIF ä¸¦é¡¯ç¤ºç¥ç¦èˆ‡æŒ‰éˆ•ï¼ˆå»¶é²ä¸€é»è®“åˆ‡æ›ä¸çªå…€ï¼‰
  video.addEventListener('ended', () => {
    // éš±è—å½±ç‰‡ã€é¡¯ç¤º gifï¼ˆç›¡é‡ä¸é–ƒï¼šå…ˆæŠŠ gif è¨­ç‚º visible ä¸”é€æ˜åº¦åˆ‡æ›ï¼‰
    video.style.display = 'none';
    gif.style.display = 'block';
    // é¡¯ç¤ºç¥ç¦æ–‡å­—ï¼ˆç¸®æ”¾æ•ˆæœï¼‰
    setTimeout(()=>{
      const txt = document.getElementById('celebrateText');
      txt.style.opacity = 1;
      txt.style.transform = 'scale(1)';
      // å†ç­‰ 1.2s é¡¯ç¤ºæŒ‰éˆ•
      setTimeout(()=>{
        document.getElementById('buttons').style.opacity = 1;
        document.getElementById('afterCake').style.display = 'block';
      }, 1200);
    }, 300);
  });

  // æœ‰æ™‚å€™ video element åœ¨æŸäº›ç€è¦½å™¨æœƒ loop æˆ–å¿«è½‰ï¼Œå¼·åˆ¶ remove loop
  video.loop = false;
}

/* confetti ç°¡å–®ä¸åœç”¢ç”Ÿï¼ˆç›´åˆ°é é¢é—œé–‰ï¼‰ */
function startConfetti(){
  setInterval(()=> {
    const el = document.createElement('div');
    el.className = 'confetti';
    const size = Math.random()*12 + 6;
    el.style.width = size + 'px';
    el.style.height = size + 'px';
    el.style.left = (Math.random()*100) + 'vw';
    el.style.backgroundColor = `hsl(${Math.random()*360},80%,65%)`;
    el.style.animationDuration = (Math.random()*3 + 2) + 's';
    document.body.appendChild(el);
    setTimeout(()=> el.remove(), 5000);
  }, 160);
}

/* æŒ‰éˆ•äº’å‹•ï¼šæˆ‘ä¸å–œæ­¡ä¸‰éšæ®µé‚è¼¯ï¼ˆç¬¬ä¸€é¡¯ç¤ºè¡¨æƒ…, ç¬¬äºŒæ‰è½, ç¬¬ä¸‰è·³ modalï¼‰ */
let dislikeCount = 0;
const dislikeBtn = document.getElementById('dislikeBtn');
const likeBtn = document.getElementById('likeBtn');

dislikeBtn.addEventListener('click', () => {
  dislikeCount++;
  if (dislikeCount === 1) {
    // ç¬¬ä¸€æ¬¡ï¼šç”¨ç³»çµ± alert é¡¯ç¤ºç°¡å–®è¡¨æƒ…ï¼ˆä½ å…ˆå‰è¦çš„æ˜¯é¡¯ç¤º ğŸ¥ºï¼Œè‹¥éœ€ modal å¯æ”¹ï¼‰
    alert('ğŸ¥º');
  } else if (dislikeCount === 2) {
    // ç¬¬äºŒæ¬¡ï¼šè£½é€ å¹¾å€‹ emoji è½ä¸‹ï¼ˆåƒ confettiï¼‰
    for (let k=0;k<8;k++){
      const e = document.createElement('div');
      e.textContent = 'ğŸ¥¹';
      e.style.position = 'fixed';
      e.style.left = (Math.random()*90)+'vw';
      e.style.top = '-30px';
      e.style.fontSize = (18 + Math.random()*22) + 'px';
      e.style.zIndex = 40;
      e.style.transition = 'transform 3s linear, opacity 3s';
      document.body.appendChild(e);
      // translateY animation via requestAnimationFrame
      (function(el){
        setTimeout(()=> { el.style.transform = `translateY(${110 + Math.random()*30}vh)`; el.style.opacity = '0.9'; }, 20);
        setTimeout(()=> el.remove(), 3500);
      })(e);
    }
  } else {
    // ç¬¬ä¸‰æ¬¡åŠä»¥ä¸Šï¼šé¡¯ç¤ºè·Ÿç¬¬ä¸€é ä¸€æ¨£é¢¨æ ¼çš„ modalï¼ˆå¹¶å¯é‡è¦†ï¼‰
    const modal = document.getElementById('errorModal');
    const content = document.querySelector('#errorModal .modal-content');
    // ä¿®æ”¹ç‚ºä½ æƒ³è¦çš„æ–‡å­—ï¼ˆé€™è£¡ç¤ºç¯„ï¼šä½ å¿å¿ƒå—ï¼Ÿï¼‰
    content.querySelector('p:nth-child(1)').textContent = 'ä½ å¿å¿ƒå—ï¼ŸğŸ¥º';
    content.querySelector('p:nth-child(2)').textContent = '';
    modal.style.display = 'flex';
  }
});

/* modal é—œé–‰ */
function closeError(){
  const m = document.getElementById('errorModal');
  m.style.display = 'none';
  // é‡è¨­è¨ˆæ•¸ï¼ˆå¦‚ä½ è¦æ±‚æŒ‰ç¬¬ä¸‰æ¬¡å¾Œé—œé–‰è¦å›å¾©åŸä½ï¼‰
  dislikeCount = 0;
}

/* like æŒ‰éˆ•ï¼šå¯åœ¨é€™é‚Šæ”¾ä½ è¦è·³è½‰æˆ–ä¸‹ä¸€æ­¥çš„è¡Œç‚º */
likeBtn.addEventListener('click', ()=>{
  // ç›®å‰å…ˆåœæ­¢ confettiï¼ˆè‹¥æƒ³ä¿ç•™å¯æ”¹ï¼‰
  // ç›´æ¥ç¤ºç¯„ï¼šé‡è¨­é é¢æˆ–ä¸‹ä¸€å€‹æµç¨‹ï¼ˆé€™è£æš«ä¸è‡ªå‹•è·³ï¼‰
  console.log('like clicked â€” ä½ å¯ä»¥åœ¨é€™åŠ å…¥ä¸‹ä¸€é é‚è¼¯');
});

</script>
</body>
</html>
